
<!-- git verification #1 -->

<!-- <!DOCTYPE html> 
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Available Bookings</title>
</head>
<body>
    <div id="output"></div>

    <script>
        async function fetchBookings() {
            try {
                const response = await fetch('../quickmeet_api/apiendpoints.php/booking');
                const bookings = await response.json();
                const outputDiv = document.getElementById('output');
    
                for (const booking of bookings) {
                    // Display basic booking info
                    const bookingDiv = document.createElement('div');
                    bookingDiv.innerHTML = `
                        <h3>${booking.bookingtitle}</h3>
                        <p>
                            Start: ${booking.startdatetime} - End: ${booking.enddatetime} <br>
                            Description: ${booking.bookingdescription} <br>
                        </p>
                    `;
    
                    // Fetch time slots for this booking
                    const timeslotResponse = await fetch(`../quickmeet_api/apiendpoints.php/timeslot/${booking.bookingurl}/bookingurl`);
                    const timeslots = await timeslotResponse.json();
    
                    if (timeslots.length > 0) {
                        timeslots.forEach(slot => {
                            bookingDiv.innerHTML += `
                                <p>
                                    Time: ${slot.startdatetime} to ${slot.enddatetime} <br>
                                    Max People: ${slot.maxslots} <br>
                                    <button onclick="reserveSlot('${slot.sid}')">Reserve</button>
                                </p>
                            `;
                        });
                    } else {
                        bookingDiv.innerHTML += "<p>No time slots available yet.</p>";
                    }
    
                    outputDiv.appendChild(bookingDiv);
                }
            } catch (error) {
                console.error("Error fetching bookings:", error);
            }
        }
    
        // Function to reserve a slot
        async function reserveSlot(sid) {
            try {
                const response = await fetch('../quickmeet_api/apiendpoints.php/reservation', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ sid: sid })
                });
    
                if (response.ok) {
                    alert("You have successfully reserved this time slot!");
                } else {
                    alert("Failed to reserve the slot.");
                }
            } catch (error) {
                console.error("Error reserving slot:", error);
                alert("An error occurred while reserving the slot.");
            }
        }
    
        fetchBookings();
    </script>
    
</body>
</html> -->


<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Available Bookings</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f9f9f9;
        }
        h1 {
            text-align: center;
            color: #333;
        }
        .day-section {
            margin: 20px 0;
            background-color: #ffffff;
            padding: 10px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }
        h2 {
            color: #444;
            border-bottom: 1px solid #ddd;
            padding-bottom: 5px;
        }
        .booking-slot {
            margin: 10px 0;
            padding: 10px;
            background-color: #e7f3ff;
            border-radius: 5px;
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
        }
        button {
            background-color: #007bff;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 3px;
            cursor: pointer;
        }
        button:hover {
            background-color: #0056b3;
        }
        .outputDiv {
            display: flex;
        }


    </style>
</head>
<body>
    <h1>Available Bookings</h1>
    <div id="output" class="outputDiv"></div>

    <script>
        async function fetchBookings() {
            // const daysOfWeek = ["Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday"];
            const daysOfWeek = ["Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday", "Sunday"];
            const outputDiv = document.getElementById('output');

            // Initialize structure for bookings by days
            const weekBookings = {};
            daysOfWeek.forEach(day => weekBookings[day] = []);

            try {
                // Fetch all bookings
                const response = await fetch('../quickmeet_api/apiendpoints.php/booking');
                const bookings = await response.json();
                console.log(bookings);

                for (const booking of bookings) {
                    // Fetch time slots for the booking
                    const timeslotResponse = await fetch(`../quickmeet_api/apiendpoints.php/timeslot/${booking.bookingurl}/bookingurl`);
                    const timeslots = await timeslotResponse.json();
                    console.log(timeslots);

                    // Organize time slots by day of the week
                    timeslots.forEach(slot => {
                        // const startDate = new Date(slot.startdatetime);
                        // const dayName = daysOfWeek[startDate.getDay()];
                        const startDate = new Date(booking.startdatetime);

                        // Adjust the day name to start the week on Monday
                        const dayIndex = (startDate.getDay() + 6) % 7; // Sunday becomes 6, Monday becomes 0
                        const dayName = daysOfWeek[dayIndex];


                        
                        // Add time slot info to the corresponding day
                        weekBookings[dayName].push({
                            title: booking.bookingtitle,
                            description: booking.bookingdescription,
                            start: slot.startdatetime,
                            end: slot.enddatetime,
                            sid: slot.sid
                        });
                    });
                }

                // Render bookings grouped by day
                for (const day of daysOfWeek) {
                    const daySection = document.createElement('div');
                    daySection.className = 'day-section';
                    daySection.innerHTML = `<h2>${day}</h2>`;

                    // Sort time slots by start time
                    weekBookings[day].sort((a, b) => new Date(a.start) - new Date(b.start));

                    if (weekBookings[day].length > 0) {
                        weekBookings[day].forEach(slot => {
                            daySection.innerHTML += `
                                <div class="booking-slot">
                                    <strong>${slot.title}</strong><br>
                                    ${new Date(slot.start).toLocaleTimeString()} - ${new Date(slot.end).toLocaleTimeString()}<br>
                                    Description: ${slot.description} <br>
                                    <button onclick="reserveSlot('${slot.sid}')">Reserve</button>
                                </div>
                            `;
                        });
                    } else {
                        daySection.innerHTML += "<p>No bookings available for this day.</p>";
                    }
                    outputDiv.appendChild(daySection);
                }

            } catch (error) {
                console.error("Error fetching bookings:", error);
                outputDiv.innerHTML = "<p>Error loading bookings. Please try again later.</p>";
            }
        }

        async function reserveSlot(sid) {
            try {
                const response = await fetch('../quickmeet_api/apiendpoints.php/reservation', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ sid: sid })
                });

                if (response.ok) {
                    alert("You have successfully reserved this time slot!");
                } else {
                    alert("Failed to reserve the slot.");
                }
            } catch (error) {
                console.error("Error reserving slot:", error);
                alert("An error occurred while reserving the slot.");
            }
        }

        
        fetchBookings();
    </script>
</body>
</html>
